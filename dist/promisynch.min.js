!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):t.promisynch=r()}(this,function(){"use strict";var e=function(t){return null!=t&&"object"==typeof t&&!1===Array.isArray(t)};function o(t){return!0==(null!=(r=t)&&"object"==typeof r&&!1===Array.isArray(r))&&"[object Object]"===Object.prototype.toString.call(t);var r}var a=Object.prototype.toString,n=function(t){if(void 0===t)return"undefined";if(null===t)return"null";var r,n,e,o,u,i=typeof t;if("boolean"===i)return"boolean";if("string"===i)return"string";if("number"===i)return"number";if("symbol"===i)return"symbol";if("function"===i)return"GeneratorFunction"===c(t)?"generatorfunction":"function";if(r=t,Array.isArray?Array.isArray(r):r instanceof Array)return"array";if(function(t){if(t.constructor&&"function"==typeof t.constructor.isBuffer)return t.constructor.isBuffer(t);return!1}(t))return"buffer";if(function(t){try{if("number"==typeof t.length&&"function"==typeof t.callee)return!0}catch(t){if(-1!=t.message.indexOf("callee"))return!0}return!1}(t))return"arguments";if((n=t)instanceof Date||"function"==typeof n.toDateString&&"function"==typeof n.getDate&&"function"==typeof n.setDate)return"date";if((e=t)instanceof Error||"string"==typeof e.message&&e.constructor&&"number"==typeof e.constructor.stackTraceLimit)return"error";if((o=t)instanceof RegExp||"string"==typeof o.flags&&"boolean"==typeof o.ignoreCase&&"boolean"==typeof o.multiline&&"boolean"==typeof o.global)return"regexp";switch(c(t)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array"}if("function"==typeof(u=t).throw&&"function"==typeof u.return&&"function"==typeof u.next)return"generator";switch(i=a.call(t)){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator"}return i.slice(8,-1).toLowerCase().replace(/\s/g,"")};function c(t){return t.constructor?t.constructor.name:null}var u={};["Array","Number","Function","RegExp","Boolean","Date","Error","Arguments","Null","String"].forEach(function(r){u[r]=function(t){return n(t)===r.toLowerCase()}});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var f=Object.assign(u,{Undefined:function(t){return null==t},Defined:function(t){return null!=t},Element:function(t){return"object"===(void 0===t?"undefined":r(t))&&1===t.nodeType},Window:function(t){return null!=t&&t===t.window},Document:function(t){return"object"===(void 0===t?"undefined":i(t))&&9===t.nodeType},PlainObject:function(t){var r,n;return!1!==o(t)&&"function"==typeof(r=t.constructor)&&!1!==o(n=r.prototype)&&0!=n.hasOwnProperty("isPrototypeOf")},Object:e,ArrayLike:function(t){var r,n=e(r=t)?r.length:void 0;return u.Number(n)&&0<=n&&n<=9007199254740991},isItClass:function(r){return function(t){return t instanceof r}}}),s=function(t,r,n,e,o,u,i,a){if(!t){var c;if(void 0===r)c=Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var f=[n,e,o,u,i,a],s=0;(c=Error(r.replace(/%s/g,function(){return f[s++]}))).name="Invariant Violation"}throw c.framesToPop=1,c}};function l(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];if(0===r.length)return function(t){return t};if(1===r.length)return r[0];var e=r[r.length-1],o=r.slice(0,-1);return function(){return o.reduceRight(function(t,r){return r(t)},e.apply(void 0,arguments))}}var t=function(){function e(t,r){for(var n=0;n<r.length;n++){var e=r[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),y=function(t){if(Array.isArray(t)){for(var r=0,n=Array(t.length);r<t.length;r++)n[r]=t[r];return n}return Array.from(t)},h="PENDING",p="FULFILLED",m="REJECTED";function v(t,r){t._state=r}function b(t){return 1<t.length?t:t[0]}function d(t){return function(r){try{return v(r.chain,r.err?m:p),t(r)}catch(t){throw r.err=t,r.result=[t],v(r.chain,m),t}}}function g(t){return function(r){try{return t(r)}catch(t){return Object.assign(r,{err:t,result:[t]})}}}function A(t){return function(r){try{return t(r)}catch(t){var n=setTimeout(function(){throw t});return Object.assign(r,{err:t,timer:n,result:[t]})}}}function j(r){return function(t){if(r.apply(void 0,[t.err||null,t.err?null:t.result].concat(y(t.argument))),t.err)throw t.err;return t}}function _(r){return function(t){return r.apply(void 0,[t.err||null,t.err?null:t.result].concat(y(t.argument))),t}}function w(n){return function(t){var r=Object.assign({},t);return r.err||(r.result=f.Defined(r.result)?n(r.result):n.apply(void 0,y(r.argument))),r}}function S(n){return function(t){var r=Object.assign({},t);return r.err?(r.timer&&(clearTimeout(r.timer),delete r.timer),r.result=n(r.err),Object.assign(r,{err:null})):r}}var E={thenMethod:function(t,r){var n=l(d,w)(r);return t?l(n,t):n},catchMethod:function(t,r){var n=l(S)(r);return t?l(n,g(t)):n},alwaysMethod:function(t,r){var n=l(j)(r);return t?l(n,g(t)):n},thenSyncMethod:function(t){return l(A,d,w)(t)},catchSyncMethod:function(t){return l(A,S)(t)},alwaysSyncMethod:function(t){return l(A,_)(t)}};function O(t){setTimeout(function(){delete t._sync})}return function(){function a(t){var n=this;!function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,a),this._result=null,this._state=h;var e,o=null,r=(s(f.Function(e=t),"Hope: You must pass a resolver function as the first argument to the chain constructor"),function(t,r){try{e(t,r)}catch(t){r(t)}});["resolve","reject"].forEach(function(t){var e=n[t].bind(n);n[t]=function(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return e.apply(void 0,[o].concat(r))}}),["then","catch","always"].forEach(function(r){n[r]=function(t){return n._sync?(n._set=E[r+"SyncMethod"](t)(n._set),n._result=n._set.result):o=E[r+"Method"](o,t),n}});var u=this.then,i=this.catch;this.then=function(t,r){return f.Function(t)&&u(t),f.Function(r)&&i(r),n},r(this.resolve,this.reject)}return t(a,null,[{key:"of",value:function(t){return new a(t)}},{key:"resolve",value:function(r){return a.of(function(t){return t(r)})}},{key:"reject",value:function(n){return a.of(function(t,r){return r(n)})}},{key:"all",value:function(t){var n=a.of(function(){}),r=Array.from(t);return r.forEach(function(t){t.always(function(){return function(t){if(t.every(function(t){return t._state!==h})){var r=t.map(function(t){return t._result});t.some(function(t){return t._state===m})&&n.reject.apply(n,y(r)),n.resolve.apply(n,y(r))}}(r)}).catch(function(){})}),n}},{key:"race",value:function(t){var n=a.of(function(){}),r=Array.from(t);return r.forEach(function(t){t.always(function(){return function(t){if(t.some(function(t){return t._state!==h})){var r=t.find(function(t){return t._state!==h});r._state===m&&n.reject(r._result),n.resolve(r._result)}}(r)}).catch(function(){})}),n}}]),t(a,[{key:"resolve",value:function(t){for(var r=arguments.length,n=Array(1<r?r-1:0),e=1;e<r;e++)n[e-1]=arguments[e];return this._state===h&&(this._result=b(n),this._state=p,this._set={err:null,result:void 0,argument:n,chain:this},t?this._set=t(this._set):(O(this),this._sync=!0)),this}},{key:"reject",value:function(t){for(var r=arguments.length,n=Array(1<r?r-1:0),e=1;e<r;e++)n[e-1]=arguments[e];return this._state===h&&(this._result=b(n),this._state=m,this._set={err:n,result:void 0,argument:n,chain:this},t?this._set=t(this._set):(O(this),this._sync=!0)),this}}]),a}()});
